plugins {
  id 'org.xbib.gradle.plugin.jflex' version '1.1.0'
  id 'com.github.johnrengelman.shadow' version '2.0.1'
  id 'application'
}

repositories {
  jcenter()
}

dependencies {
  compile files('java-cup-11a.jar')
}

sourceSets {
    main {
        java {
            srcDirs += ["${buildDir}/generated-src/jflex/",
                        "${buildDir}/generated-src/cup/"]
        }
    }
}

task parser {
  doFirst { mkdir "${buildDir}/generated-src/cup" }
  doLast {
    javaexec {
      main = '-jar'
        workingDir = 'src/main/java'
        args = [
        file('java-cup-11a.jar'),
        '-symbols', 'Parser_sym',
        '-parser', 'Parser',
        '-destdir', "${buildDir}/generated-src/cup/",
        file('src/main/java/Parser.cup')
        ]
    }
  }
}

jar {
  manifest {
    attributes = [
      'Main-Class': 'Main'
    ]
  }
}
compileJava.dependsOn parser


mainClassName = 'Main'
jar.enabled = false
shadowJar {
   baseName = 'Straightline'
   classifier = null
   version = null
}
build.dependsOn shadowJar
